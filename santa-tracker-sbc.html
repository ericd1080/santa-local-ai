<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santa Tracker SBC - Hybrid Cloud Architecture üéÖ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÖ</text></svg>">

    <!-- External Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Leaflet for interactive maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

    <style>
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        @keyframes giftDrop {
            0% { transform: translateY(-100vh) rotate(0deg) scale(0.8); opacity: 0; }
            10% { opacity: 1; transform: translateY(-80vh) rotate(45deg) scale(1); }
            50% { transform: translateY(30vh) rotate(180deg) scale(1.1); opacity: 1; }
            70% { transform: translateY(70vh) rotate(270deg) scale(1); opacity: 1; }
            85% { transform: translateY(85vh) rotate(360deg) scale(0.9); opacity: 0.8; }
            100% { transform: translateY(100vh) rotate(450deg) scale(0.7); opacity: 0; }
        }

        @keyframes sleighMove {
            0% { transform: translateX(-100px) translateY(0px); }
            25% { transform: translateX(25vw) translateY(-10px); }
            50% { transform: translateX(50vw) translateY(-5px); }
            75% { transform: translateX(75vw) translateY(-15px); }
            100% { transform: translateX(calc(100vw + 100px)) translateY(-8px); }
        }

        .twinkle { animation: twinkle 2s infinite; }
        .gift-drop { animation: giftDrop 4s ease-in-out; }
        .sleigh-move { animation: sleighMove 20s linear infinite; }

        .christmas-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #0f172a 100%);
            min-height: 100vh;
        }

        .snowflake {
            position: absolute;
            color: white;
            font-size: 1rem;
            animation: fall linear infinite;
            pointer-events: none;
        }

        @keyframes fall {
            to { transform: translateY(100vh); }
        }

        .sbc-badge {
            background: linear-gradient(45deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .groq-badge {
            background: linear-gradient(45deg, #f59e0b, #d97706);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        /* üéØ IPAD-OPTIMIZED LARGE TEXT for distance viewing */
        @media screen and (min-width: 768px) {
            .ipad-large-text h1 { font-size: 4rem !important; }
            .ipad-large-text h2 { font-size: 2.5rem !important; }
            .ipad-large-text .santa-message {
                font-size: 2rem !important;
                line-height: 1.4 !important;
                padding: 2rem !important;
            }
            .ipad-large-text .location-info {
                font-size: 1.5rem !important;
                line-height: 1.6 !important;
            }
            .ipad-large-text .ask-santa-btn {
                font-size: 1.75rem !important;
                padding: 1.5rem 3rem !important;
                margin: 2rem 0 !important;
            }
            .ipad-large-text .status-bar {
                font-size: 1.25rem !important;
                padding: 1.5rem !important;
            }
            .ipad-large-text .config-text {
                font-size: 1rem !important;
            }
        }

        /* Family context indicator */
        .family-indicator {
            background: linear-gradient(45deg, #8b5cf6, #a855f7);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
    </style>
</head>
<body class="christmas-bg">
    <div id="app"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // SBC API Client
        class SBCApiClient {
            constructor() {
                this.baseUrl = window.location.origin;
            }


            async getStatus() {
                try {
                    const response = await fetch(`${this.baseUrl}/api/groq/status`);
                    return await response.json();
                } catch (error) {
                    console.error('Status check failed:', error);
                    return { status: 'offline', error: error.message };
                }
            }

            async getModels() {
                try {
                    const response = await fetch(`${this.baseUrl}/api/models`);
                    return await response.json();
                } catch (error) {
                    console.error('Failed to get models:', error);
                    return { models: [] };
                }
            }

            async switchModel(modelName) {
                try {
                    const response = await fetch(`${this.baseUrl}/api/models/switch`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ model: modelName })
                    });
                    return await response.json();
                } catch (error) {
                    console.error('Model switch failed:', error);
                    throw error;
                }
            }

            async getFamilyData(language = 'en') {
                try {
                    const response = await fetch(`${this.baseUrl}/api/family?language=${language}`);
                    return await response.json();
                } catch (error) {
                    console.error('Failed to get family data:', error);
                    return { hasData: false };
                }
            }

            async reloadFamilyData(language = 'en') {
                try {
                    const response = await fetch(`${this.baseUrl}/api/family/reload`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ language: language })
                    });
                    return await response.json();
                } catch (error) {
                    console.error('Failed to reload family data:', error);
                    throw error;
                }
            }

            async generateMessage(promptType = 'delivering', context = {}, language = 'en') {
                try {
                    const response = await fetch(`${this.baseUrl}/api/generate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            prompt_type: promptType,
                            context: context,
                            language: language
                        })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error || `HTTP ${response.status}`);
                    }

                    return data;
                } catch (error) {
                    console.error('SBC API Error:', error);
                    throw error;
                }
            }
        }

        // Initialize API client
        const apiClient = new SBCApiClient();

        // Santa Location Calculator
        const SantaLocationCalculator = {
            getCurrentLocation() {
                const now = new Date();
                const christmas = new Date(now.getFullYear(), 11, 25); // December 25
                const timeDiff = christmas.getTime() - now.getTime();
                const hoursUntilChristmas = timeDiff / (1000 * 3600);

                if (hoursUntilChristmas > 24) {
                    return {
                        phase: 'preparing',
                        location: 'North Pole',
                        lat: 90,
                        lng: 0,
                        message: 'Santa is preparing for Christmas Eve!'
                    };
                } else if (hoursUntilChristmas > 0) {
                    const progress = (24 - hoursUntilChristmas) / 24;
                    const route = [
                        { name: 'New Zealand', lat: -41.2, lng: 174.8 },
                        { name: 'Australia', lat: -25.3, lng: 131.0 },
                        { name: 'Japan', lat: 36.2, lng: 138.3 },
                        { name: 'China', lat: 35.9, lng: 104.2 },
                        { name: 'India', lat: 20.6, lng: 78.9 },
                        { name: 'Russia', lat: 61.5, lng: 105.3 },
                        { name: 'Europe', lat: 54.5, lng: 15.3 },
                        { name: 'Africa', lat: -8.8, lng: 34.5 },
                        { name: 'Brazil', lat: -14.2, lng: -51.9 },
                        { name: 'USA', lat: 37.1, lng: -95.7 },
                        { name: 'Canada', lat: 56.1, lng: -106.3 }
                    ];

                    const currentIndex = Math.floor(progress * route.length);
                    const currentLocation = route[Math.min(currentIndex, route.length - 1)];

                    return {
                        phase: 'delivering',
                        location: currentLocation.name,
                        lat: currentLocation.lat,
                        lng: currentLocation.lng,
                        progress: Math.round(progress * 100),
                        timeRemaining: Math.ceil(hoursUntilChristmas)
                    };
                } else {
                    return {
                        phase: 'finished',
                        location: 'North Pole',
                        lat: 90,
                        lng: 0,
                        message: 'Christmas deliveries complete! üéÖ'
                    };
                }
            }
        };

        // Santa Map Component for SBC
        function SantaMapSBC({ isVisible, santaLocation, onClose }) {
            const mapRef = useRef(null);
            const mapInstance = useRef(null);

            useEffect(() => {
                if (isVisible && santaLocation && !mapInstance.current && mapRef.current) {
                    console.log('üó∫Ô∏è Starting SBC Santa map initialization...');

                    // Delay initialization to ensure DOM is fully rendered
                    const initTimeout = setTimeout(() => {
                        try {
                            const container = mapRef.current;
                            if (!container) {
                                console.error('‚ùå SBC Map container not available!');
                                return;
                            }

                            // Force container to have proper dimensions
                            container.style.width = '100%';
                            container.style.height = '100%';
                            container.style.minHeight = '400px';
                            container.style.position = 'relative';
                            container.style.display = 'block';
                            container.innerHTML = ''; // Clear any existing content

                            // Check dimensions after styling
                            const rect = container.getBoundingClientRect();
                            console.log(`üìê SBC Map container dimensions: ${rect.width}x${rect.height}`);

                            if (rect.width === 0 || rect.height === 0) {
                                console.error('‚ùå SBC Map container still has zero dimensions after styling!');
                                return;
                            }

                            console.log('üó∫Ô∏è Initializing SBC Leaflet map...');

                            // Initialize map with robust configuration
                            const map = L.map(container, {
                                zoomControl: true,
                                scrollWheelZoom: true,
                                doubleClickZoom: true,
                                touchZoom: true,
                                dragging: true,
                                preferCanvas: false, // Use SVG for better compatibility
                                attributionControl: false,
                                fadeAnimation: true,
                                zoomAnimation: true,
                                inertia: true,
                                renderer: L.svg() // Force SVG renderer
                            });

                            // Set initial view
                            map.setView([santaLocation.lat, santaLocation.lng], 4);

                            console.log('‚úÖ SBC Leaflet map initialized, adding tiles...');

                            // Add robust tile layer with multiple fallback providers
                            const tileProviders = [
                                {
                                    url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                                    attribution: '¬© OpenStreetMap contributors',
                                    name: 'OpenStreetMap',
                                    maxZoom: 19
                                },
                                {
                                    url: 'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',
                                    attribution: '¬© CARTO ¬© OpenStreetMap contributors',
                                    name: 'CartoDB Voyager',
                                    maxZoom: 19
                                },
                                {
                                    url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}',
                                    attribution: '¬© Esri',
                                    name: 'Esri World Street',
                                    maxZoom: 19
                                }
                            ];

                            // Set up tile layer management
                            let currentProviderIndex = 0;
                            let tileLayer = null;
                            let loadAttempts = 0;
                            const maxLoadAttempts = tileProviders.length;

                            const createTileLayer = (providerIndex = 0) => {
                                if (providerIndex >= tileProviders.length) {
                                    console.error('‚ùå All SBC tile providers failed! Map will show base background only.');
                                    // Create a backup colored layer instead of failing completely
                                    const backupLayer = L.tileLayer('data:image/svg+xml;base64,' +
                                        btoa('<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256"><rect width="256" height="256" fill="#e0f2fe"/><text x="128" y="128" text-anchor="middle" fill="#0284c7" font-family="Arial" font-size="16">üåç</text></svg>'), {
                                        maxZoom: 18,
                                        attribution: 'üéÖ Santa SBC Map'
                                    });
                                    return backupLayer;
                                }

                                const provider = tileProviders[providerIndex];
                                console.log(`üó∫Ô∏è SBC Loading tiles from: ${provider.name} (attempt ${loadAttempts + 1}/${maxLoadAttempts})`);

                                const layer = L.tileLayer(provider.url, {
                                    maxZoom: provider.maxZoom || 18,
                                    minZoom: 1,
                                    attribution: provider.attribution,
                                    updateWhenIdle: false,
                                    keepBuffer: 0,
                                    maxNativeZoom: provider.maxZoom || 18,
                                    timeout: 8000,
                                    crossOrigin: true,
                                    // Use a simple gray tile for errors instead of transparent
                                    errorTileUrl: 'data:image/svg+xml;base64,' +
                                        btoa('<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256"><rect width="256" height="256" fill="#f3f4f6"/></svg>')
                                });

                                let tileLoadCount = 0;
                                let tileErrorCount = 0;

                                // Handle successful tile loading
                                layer.on('tileload', function() {
                                    tileLoadCount++;
                                    if (tileLoadCount === 1) {
                                        console.log(`‚úÖ First SBC tile loaded successfully from ${provider.name}`);
                                    }
                                });

                                // Handle tile loading errors with smarter fallback
                                layer.on('tileerror', function(error) {
                                    tileErrorCount++;
                                    console.warn(`‚ö†Ô∏è SBC Tile error from ${provider.name} (${tileErrorCount} errors so far)`);

                                    // If we get many errors and haven't loaded many tiles, try next provider
                                    if (tileErrorCount > 3 && tileLoadCount === 0 && currentProviderIndex < tileProviders.length - 1) {
                                        console.log('üîÑ SBC Too many tile errors, switching provider...');
                                        currentProviderIndex++;
                                        loadAttempts++;

                                        setTimeout(() => {
                                            map.removeLayer(layer);
                                            const fallbackLayer = createTileLayer(currentProviderIndex);
                                            if (fallbackLayer) {
                                                fallbackLayer.addTo(map);
                                            }
                                        }, 1000);
                                    }
                                });

                                return layer;
                            };

                            // Create and add the initial tile layer
                            tileLayer = createTileLayer(0);
                            if (tileLayer) {
                                tileLayer.addTo(map);
                                console.log('üó∫Ô∏è SBC Tile layer added to map');
                            }

                            // Add attribution control
                            L.control.attribution({position: 'bottomright', prefix: false}).addTo(map);

                            // Store map instance
                            mapInstance.current = map;
                            // Add Santa marker after map is initialized
                            const santaIcon = L.divIcon({
                                html: 'üéÖ',
                                className: 'santa-marker',
                                iconSize: [30, 30],
                                iconAnchor: [15, 15]
                            });

                            L.marker([santaLocation.lat, santaLocation.lng], { icon: santaIcon })
                                .addTo(map)
                                .bindPopup(`üéÖ Santa is in ${santaLocation.location}!`);

                            console.log('üéâ SBC Santa map fully initialized!');

                        } catch (error) {
                            console.error('‚ùå Failed to initialize SBC map:', error);
                            // Show user-friendly error
                            if (mapRef.current) {
                                mapRef.current.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #e0f2fe, #bae6fd); color: #0284c7; font-size: 18px; text-align: center; padding: 20px;"><div>üó∫Ô∏è<br/>Map temporarily unavailable<br/><small>Santa is still trackable!</small></div></div>';
                            }
                        }
                    }, 100); // 100ms delay for DOM readiness
                }

                return () => {
                    if (mapInstance.current) {
                        try {
                            mapInstance.current.remove();
                            mapInstance.current = null;
                        } catch (error) {
                            console.warn('SBC Map cleanup warning:', error);
                        }
                    }
                };
            }, [isVisible, santaLocation]);

            if (!isVisible) return null;

            return (
                <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" onClick={onClose}>
                    <div className="bg-white rounded-lg p-4 max-w-4xl max-h-[80vh] w-full mx-4" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-xl font-bold">üó∫Ô∏è Santa's Location</h3>
                            <button onClick={onClose} className="text-2xl hover:text-red-600">√ó</button>
                        </div>
                        <div ref={mapRef} className="w-full h-96 rounded-lg"></div>
                        <div className="mt-4 text-center">
                            <p className="text-lg">üéÖ Santa is currently in <strong>{santaLocation?.location}</strong></p>
                            {santaLocation?.progress && (
                                <p className="text-sm text-gray-600">Progress: {santaLocation.progress}% complete</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Main App Component
        function SantaTrackerSBC() {
            const [santaLocation, setSantaLocation] = useState(null);
            const [santaMessage, setSantaMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [apiStatus, setApiStatus] = useState(null);
            const [models, setModels] = useState([]);
            const [currentModel, setCurrentModel] = useState('');
            const [showConfig, setShowConfig] = useState(false);
            const [error, setError] = useState(null);
            const [familyData, setFamilyData] = useState({ hasData: false });
            const [largeText, setLargeText] = useState(true); // Default to large text for iPad
            const [showSantaMap, setShowSantaMap] = useState(false);
            const [currentLanguage, setCurrentLanguage] = useState('en');

            // Initialize
            useEffect(() => {
                updateSantaLocation();
                checkApiStatus();
                loadModels();
                loadFamilyData();

                const interval = setInterval(updateSantaLocation, 30000); // Update every 30s
                return () => clearInterval(interval);
            }, []);

            const updateSantaLocation = () => {
                const location = SantaLocationCalculator.getCurrentLocation();
                setSantaLocation(location);
            };

            const checkApiStatus = async () => {
                try {
                    const status = await apiClient.getStatus();
                    setApiStatus(status);
                    setCurrentModel(status.defaultModel || '');
                } catch (error) {
                    setApiStatus({ status: 'offline', error: error.message });
                }
            };

            const loadModels = async () => {
                try {
                    const data = await apiClient.getModels();
                    setModels(data.models || []);
                } catch (error) {
                    console.error('Failed to load models:', error);
                }
            };

            const loadFamilyData = async (language = 'en') => {
                try {
                    // For SBC version, we need to pass language to the API
                    const data = await apiClient.getFamilyData(language);
                    setFamilyData(data);
                } catch (error) {
                    console.error('Failed to load family data:', error);
                }
            };

            const reloadFamilyDatabase = async () => {
                try {
                    const result = await apiClient.reloadFamilyData();
                    await loadFamilyData();
                    alert(result.message || 'Family database reloaded!');
                } catch (error) {
                    alert('Failed to reload family database: ' + error.message);
                }
            };

            const generateSantaMessage = async () => {
                if (!santaLocation || isLoading) return;

                setIsLoading(true);
                setError(null);

                try {
                    const context = {
                        distance: santaLocation.location ? `Currently visiting ${santaLocation.location}.` : '',
                        gifts: santaLocation.progress ? `${santaLocation.progress}% of deliveries completed.` : ''
                    };

                    const response = await apiClient.generateMessage(santaLocation.phase, context, currentLanguage);

                    if (response.error) {
                        setError(response.error);
                        const fallbackMessage = currentLanguage === 'ko' ?
                            'Ìò∏Ìò∏Ìò∏! Î≠îÍ∞Ä ÏûòÎ™ªÎêòÏóàÏßÄÎßå ÌÅ¨Î¶¨Ïä§ÎßàÏä§ ÎßàÎ≤ïÏù¥ Ïù¥Í≤®ÎÇº Í±∞ÏòàÏöî! üéÖ' :
                            'Ho ho ho! Something went wrong, but Christmas magic will prevail! üéÖ';
                        setSantaMessage(fallbackMessage);
                    } else {
                        setSantaMessage(response.response);
                    }
                } catch (error) {
                    setError(error.message);
                    setSantaMessage('Ho ho ho! The North Pole connection is a bit snowy right now! üéÖ');
                } finally {
                    setIsLoading(false);
                }
            };

            const switchModel = async (modelName) => {
                try {
                    await apiClient.switchModel(modelName);
                    setCurrentModel(modelName);
                    checkApiStatus();
                } catch (error) {
                    setError(error.message);
                }
            };

            const getStatusColor = () => {
                if (!apiStatus) return 'gray';
                return apiStatus.status === 'online' ? 'green' : 'red';
            };

            if (!santaLocation) {
                return (
                    <div className="flex items-center justify-center min-h-screen">
                        <div className="text-white text-xl">üéÖ Loading Santa's location...</div>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen p-4 ${largeText ? 'ipad-large-text' : ''}`}>
                    <Snowfall />

                    {/* Header */}
                    <div className="text-center mb-8">
                        <h1 className="text-5xl font-bold text-white mb-2">
                            üéÖ Santa Tracker SBC
                        </h1>
                        <div className="flex justify-center gap-4 mb-4 flex-wrap">
                            <div className="sbc-badge text-white px-4 py-2 rounded-full text-sm">
                                üöÄ Hybrid Architecture
                            </div>
                            <div className="groq-badge text-white px-4 py-2 rounded-full text-sm">
                                ‚ö° Groq Powered
                            </div>
                            {familyData.hasData && (
                                <div className="family-indicator text-white px-4 py-2 rounded-full text-sm">
                                    üè† {familyData.familyName} Family
                                </div>
                            )}
                        </div>
                        <p className="text-gray-300">
                            Raspberry Pi 3B + Cloud AI = Christmas Magic! ‚ú®
                        </p>
                    </div>

                    {/* API Status */}
                    <div className={`status-bar text-center mb-6 p-4 rounded-lg ${getStatusColor() === 'green' ? 'bg-green-900 border border-green-700' : 'bg-red-900 border border-red-700'}`}>
                        <div className="text-white">
                            Status: <span className="font-bold">{apiStatus?.status || 'checking...'}</span>
                            {currentModel && (
                                <span className="ml-4">Model: <span className="font-bold">{currentModel}</span></span>
                            )}
                            {familyData.hasData && (
                                <span className="ml-4">üìç {familyData.location}</span>
                            )}
                        </div>
                        {error && (
                            <div className="text-red-300 text-sm mt-2">{error}</div>
                        )}
                    </div>

                    {/* iPad Controls */}
                    <div className="text-center mb-6">
                        <div className="flex justify-center gap-4 flex-wrap">
                            <button
                                onClick={() => setLargeText(!largeText)}
                                className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm"
                            >
                                üì± {largeText ? 'Small Text' : 'Large Text'}
                            </button>
                            <button
                                onClick={() => {
                                    const newLang = currentLanguage === 'ko' ? 'en' : 'ko';
                                    setCurrentLanguage(newLang);
                                    loadFamilyData(newLang);
                                }}
                                className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm"
                            >
                                üåê {currentLanguage === 'ko' ? 'ÌïúÍµ≠Ïñ¥' : 'English'}
                            </button>
                            {familyData.hasData && (
                                <button
                                    onClick={reloadFamilyDatabase}
                                    className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm"
                                    title="Emergency IT Parent Override!"
                                >
                                    üîÑ Reload Family Data
                                </button>
                            )}
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-4xl mx-auto">
                        <div className="grid md:grid-cols-2 gap-8">
                            {/* Santa's Location */}
                            <div className="bg-white/10 backdrop-blur rounded-lg p-6 border border-white/20">
                                <h2 className="text-2xl font-bold text-white mb-4">üåç Santa's Location</h2>

                                <div className="location-info text-white space-y-3">
                                    <div>
                                        <strong>Current Location:</strong> {santaLocation.location}
                                    </div>

                                    {santaLocation.phase === 'delivering' && (
                                        <>
                                            <div>
                                                <strong>Progress:</strong> {santaLocation.progress}%
                                            </div>
                                            <div>
                                                <strong>Time Until Christmas:</strong> {santaLocation.timeRemaining} hours
                                            </div>
                                            <div className="bg-gray-700 rounded-full h-4">
                                                <div
                                                    className="bg-red-500 rounded-full h-4 transition-all duration-500"
                                                    style={{ width: `${santaLocation.progress}%` }}
                                                ></div>
                                            </div>
                                        </>
                                    )}

                                    {santaLocation.phase === 'preparing' && (
                                        <div className="text-yellow-300">
                                            üéÅ Elves are wrapping presents at the North Pole!
                                        </div>
                                    )}

                                    {santaLocation.phase === 'finished' && (
                                        <div className="text-green-300">
                                            üéâ All presents delivered! Santa is resting.
                                        </div>
                                    )}

                                    <div className="mt-4">
                                        <button
                                            onClick={() => setShowSantaMap(true)}
                                            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors"
                                        >
                                            üó∫Ô∏è Show Santa on Map
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {/* Santa's Message */}
                            <div className="bg-white/10 backdrop-blur rounded-lg p-6 border border-white/20">
                                <h2 className="text-2xl font-bold text-white mb-4">üí¨ Message from Santa</h2>

                                <div className="mb-4">
                                    <button
                                        onClick={generateSantaMessage}
                                        disabled={isLoading || apiStatus?.status !== 'online'}
                                        className="ask-santa-btn bg-red-600 hover:bg-red-700 disabled:bg-gray-600 text-white px-6 py-3 rounded-lg font-bold transition-all duration-200 disabled:cursor-not-allowed"
                                    >
                                        {isLoading ? 'ü§ñ Generating...' : 'üéÖ Ask Santa!'}
                                    </button>
                                </div>

                                {santaMessage && (
                                    <div className="santa-message bg-red-900/50 border border-red-700 rounded-lg p-4">
                                        <div className="text-white text-lg leading-relaxed">
                                            "{santaMessage}"
                                        </div>
                                        <div className="text-red-300 text-sm mt-2">
                                            ‚Äî Santa Claus üéÖ
                                            {familyData.hasData && (
                                                <span className="ml-2 text-purple-300">‚ú® Personalized</span>
                                            )}
                                        </div>
                                    </div>
                                )}

                                {!santaMessage && !isLoading && (
                                    <div className="text-gray-400 italic">
                                        Click the button to get a personalized message from Santa!
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Configuration Panel */}
                        <div className="mt-8">
                            <button
                                onClick={() => setShowConfig(!showConfig)}
                                className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg mb-4"
                            >
                                ‚öôÔ∏è {showConfig ? 'Hide' : 'Show'} Configuration
                            </button>

                            {showConfig && (
                                <div className="config-text bg-white/10 backdrop-blur rounded-lg p-6 border border-white/20">
                                    <h3 className="text-xl font-bold text-white mb-4">üîß SBC Configuration</h3>

                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div>
                                            <h4 className="text-white font-bold mb-2">Available Models</h4>
                                            <div className="space-y-2">
                                                {models.map((model) => (
                                                    <button
                                                        key={model.name}
                                                        onClick={() => switchModel(model.name)}
                                                        className={`w-full text-left p-3 rounded border transition-all ${
                                                            currentModel === model.name
                                                                ? 'bg-blue-900 border-blue-700 text-white'
                                                                : 'bg-gray-800 border-gray-600 text-gray-300 hover:bg-gray-700'
                                                        }`}
                                                    >
                                                        <div className="font-bold">{model.displayName}</div>
                                                        <div className="text-sm opacity-80">{model.description}</div>
                                                        {model.maxTokens && (
                                                            <div className="text-xs opacity-60">
                                                                Max tokens: {model.maxTokens}
                                                            </div>
                                                        )}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        <div>
                                            <h4 className="text-white font-bold mb-2">System Info</h4>
                                            <div className="bg-gray-900 rounded p-3 font-mono text-sm text-gray-300">
                                                <div>Architecture: Hybrid SBC</div>
                                                <div>Host: Raspberry Pi 3B</div>
                                                <div>AI Provider: Groq Cloud</div>
                                                <div>Frontend: React + Tailwind</div>
                                                <div>Backend: Flask + Python</div>
                                                <div>Real-time: WebSocket Ready</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Footer */}
                        <div className="text-center mt-12 text-gray-400">
                            <div className="mb-2">
                                üéÑ Santa Tracker SBC - Hybrid Cloud Architecture üéÑ
                            </div>
                            <div className="text-sm">
                                Powered by Raspberry Pi 3B + Groq AI + Christmas Magic ‚ú®
                            </div>
                        </div>
                    </div>

                    {/* Santa Map Modal */}
                    <SantaMapSBC
                        isVisible={showSantaMap}
                        santaLocation={santaLocation}
                        onClose={() => setShowSantaMap(false)}
                    />
                </div>
            );
        }

        // Snowfall Effect Component
        function Snowfall() {
            const [snowflakes, setSnowflakes] = useState([]);

            useEffect(() => {
                const createSnowflake = () => ({
                    id: Math.random(),
                    left: Math.random() * 100,
                    animationDuration: Math.random() * 3 + 2,
                    opacity: Math.random(),
                    fontSize: Math.random() * 10 + 10,
                });

                const initialSnowflakes = Array.from({ length: 50 }, createSnowflake);
                setSnowflakes(initialSnowflakes);

                const interval = setInterval(() => {
                    setSnowflakes(prev => {
                        const newSnowflakes = [...prev];
                        if (newSnowflakes.length < 50) {
                            newSnowflakes.push(createSnowflake());
                        }
                        return newSnowflakes.slice(-50); // Keep only last 50
                    });
                }, 300);

                return () => clearInterval(interval);
            }, []);

            return (
                <div className="fixed inset-0 pointer-events-none overflow-hidden">
                    {snowflakes.map((flake) => (
                        <div
                            key={flake.id}
                            className="snowflake"
                            style={{
                                left: `${flake.left}%`,
                                animationDuration: `${flake.animationDuration}s`,
                                opacity: flake.opacity,
                                fontSize: `${flake.fontSize}px`,
                            }}
                        >
                            ‚ùÑ
                        </div>
                    ))}
                </div>
            );
        }

        // Render App
        ReactDOM.render(<SantaTrackerSBC />, document.getElementById('app'));
    </script>
</body>
</html>